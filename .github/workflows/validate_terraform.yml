name: Validate Terraform

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ” EVENTO QUE DISPARA O WORKFLOW
# Aciona apenas em push para branches que NÃƒO sejam main ou develop
# Ãštil para validar mudanÃ§as antes de mesclar em branches principais
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
on:
  push:
    branches-ignore:
      - main
      - develop

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# âœ… JOB 1: ValidaÃ§Ã£o do mÃ³dulo de infraestrutura (ecs_infra.tf)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
jobs:
  validate-infra:
    name: Validar ecs_infra.tf
    runs-on: ubuntu-latest

    # Define o diretÃ³rio de trabalho para o mÃ³dulo de infraestrutura
    defaults:
      run:
        working-directory: examples/infra

    steps:
      # ğŸ“¥ Etapa 1: Clonar o repositÃ³rio
      - name: Checkout do cÃ³digo
        uses: actions/checkout@v3

      # ğŸ”§ Etapa 2: Instalar Terraform (v1.6.6)
      - name: Instalar Terraform (versÃ£o 1.6.6)
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: 1.6.6

      # âš™ï¸ Etapa 3: Inicializar Terraform (sem backend remoto)
      - name: Inicializar Terraform (sem backend)
        run: terraform init -backend=false -input=false

      # ğŸ” Etapa 4: Validar sintaxe dos arquivos Terraform
      - name: Validar sintaxe Terraform (ecs_infra)
        run: terraform validate -no-color

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# âœ… JOB 2: ValidaÃ§Ã£o do mÃ³dulo de aplicaÃ§Ã£o (ecs_app.tf)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  validate-app:
    name: Validar ecs_app.tf
    runs-on: ubuntu-latest

    # Define o diretÃ³rio de trabalho para o mÃ³dulo de aplicaÃ§Ã£o
    defaults:
      run:
        working-directory: examples/app

    steps:
      # ğŸ“¥ Etapa 1: Clonar o repositÃ³rio
      - name: Checkout do cÃ³digo
        uses: actions/checkout@v3

      # ğŸ”§ Etapa 2: Instalar Terraform (v1.6.6)
      - name: Instalar Terraform (versÃ£o 1.6.6)
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: 1.6.6

      # âš™ï¸ Etapa 3: Inicializar Terraform (sem backend remoto)
      - name: Inicializar Terraform (sem backend)
        run: terraform init -backend=false -input=false

      # ğŸ” Etapa 4: Validar sintaxe dos arquivos Terraform
      - name: Validar sintaxe Terraform (ecs_app)
        run: terraform validate -no-color
